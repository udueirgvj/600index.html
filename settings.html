<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªÙˆØ§ØµÙ„ - Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</title>
    <style>
        /* Ù…ØªØºÙŠØ±Ø§Øª Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙˆØ§Ù„Ø¯Ø§ÙƒÙ† */
        :root {
            --bg-primary: #f0f2f5;
            --bg-secondary: #ffffff;
            --text-primary: #1a2b3e;
            --text-secondary: #4b5f73;
            --border-color: #eef2f7;
            --accent-color: #2A6B9C;
            --accent-hover: #1f4e7a;
            --danger-color: #dc3545;
            --danger-hover: #bb2d3b;
            --shadow: 0 5px 15px rgba(0,0,0,0.05);
            --card-bg: #ffffff;
        }

        body.dark-mode {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --text-primary: #e0e0e0;
            --text-secondary: #a0a0a0;
            --border-color: #2a2a4a;
            --accent-color: #4a6fa5;
            --accent-hover: #3a5a8a;
            --danger-color: #b02a37;
            --danger-hover: #9a1f2b;
            --shadow: 0 5px 15px rgba(0,0,0,0.3);
            --card-bg: #16213e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: var(--bg-primary);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            transition: background 0.3s, color 0.3s;
        }
        .header {
            background: var(--accent-color);
            color: white;
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .back-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.8rem;
            cursor: pointer;
            line-height: 1;
        }
        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            flex: 1;
        }
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
        .sidebar {
            width: 280px;
            background: var(--bg-secondary);
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1rem 0;
            transition: transform 0.3s ease, background 0.3s;
        }
        .sidebar.hidden {
            transform: translateX(100%);
            width: 0;
            min-width: 0;
        }
        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            cursor: pointer;
            transition: background 0.2s;
            color: var(--text-primary);
            border-right: 3px solid transparent;
        }
        .sidebar-item:hover {
            background: var(--bg-primary);
        }
        .sidebar-item.active {
            background: var(--bg-primary);
            border-right-color: var(--accent-color);
            color: var(--accent-color);
            font-weight: 500;
        }
        .sidebar-item .icon {
            font-size: 1.3rem;
            width: 24px;
            text-align: center;
        }
        .sidebar-item .text {
            flex: 1;
        }
        /* Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: var(--bg-primary);
            transition: all 0.3s ease;
        }
        .content.full {
            max-width: 800px;
            margin: 0 auto;
        }
        .content-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: var(--shadow);
            max-width: 600px;
            margin: 0 auto;
            transition: background 0.3s, box-shadow 0.3s;
        }
        .content-card h2 {
            color: var(--text-primary);
            margin-bottom: 1.5rem;
            font-size: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 0.8rem;
        }
        .input-group {
            margin-bottom: 1.2rem;
        }
        .input-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 0.3rem;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 12px;
            background: var(--bg-primary);
            font-size: 1rem;
            outline: none;
            color: var(--text-primary);
            transition: border 0.2s, background 0.3s;
        }
        .input-group input:focus, .input-group textarea:focus {
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(42,107,156,0.1);
        }
        .input-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        .btn {
            width: 100%;
            padding: 0.8rem;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 30px;
            background: var(--accent-color);
            color: white;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 1rem;
        }
        .btn:hover {
            background: var(--accent-hover);
        }
        .btn-secondary {
            background: var(--text-secondary);
        }
        .btn-secondary:hover {
            background: #5a6268;
        }
        .btn-danger {
            background: var(--danger-color);
        }
        .btn-danger:hover {
            background: var(--danger-hover);
        }
        .message {
            padding: 0.8rem;
            border-radius: 10px;
            margin-top: 1rem;
            text-align: center;
            display: none;
        }
        .message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        .message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
        .info-text {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        .user-info {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 16px;
            margin-bottom: 1.5rem;
            transition: background 0.3s;
        }
        .user-info p {
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        .user-info strong {
            color: var(--accent-color);
            min-width: 100px;
            display: inline-block;
        }
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
        }
        .faq-item {
            background: var(--bg-primary);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 1rem;
            cursor: pointer;
            transition: background 0.2s;
        }
        .faq-item:hover {
            background: var(--border-color);
        }
        .faq-item h4 {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-primary);
        }
        .faq-item p {
            margin-top: 0.5rem;
            color: var(--text-secondary);
            display: none;
        }
        .faq-item.active p {
            display: block;
        }
        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© */
        .profile-image {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        .profile-image img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .profile-image .avatar-placeholder {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            font-weight: bold;
            margin: 0 auto;
            border: 3px solid var(--accent-color);
        }
        .image-upload {
            margin-top: 0.5rem;
        }
        .image-upload input[type="file"] {
            display: none;
        }
        .image-upload label {
            background: var(--accent-color);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            cursor: pointer;
            display: inline-block;
            font-size: 0.9rem;
        }
        /* Ø²Ø± Ø§Ù„Ø¯Ø¹Ù… */
        .support-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 30px;
            padding: 0.8rem 1.5rem;
            font-size: 1rem;
            cursor: pointer;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }
    </style>
</head>
<body class="">
    <div class="header">
        <button class="back-btn" id="mainBackBtn" onclick="goBack()">â†</button>
        <h1>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h1>
        <div style="width: 40px;"></div>
    </div>

    <div class="container" id="container">
        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-item active" data-section="account">
                <span class="icon">ğŸ‘¤</span>
                <span class="text">Ø§Ù„Ø­Ø³Ø§Ø¨</span>
            </div>
            <div class="sidebar-item" data-section="chats">
                <span class="icon">ğŸ’¬</span>
                <span class="text">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</span>
            </div>
            <div class="sidebar-item" data-section="privacy">
                <span class="icon">ğŸ”’</span>
                <span class="text">Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†</span>
            </div>
            <div class="sidebar-item" data-section="notifications">
                <span class="icon">ğŸ””</span>
                <span class="text">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</span>
            </div>
            <div class="sidebar-item" data-section="storage">
                <span class="icon">ğŸ“</span>
                <span class="text">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†</span>
            </div>
            <div class="sidebar-item" data-section="folders">
                <span class="icon">ğŸ“‚</span>
                <span class="text">Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</span>
            </div>
            <div class="sidebar-item" data-section="devices">
                <span class="icon">ğŸ“±</span>
                <span class="text">Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</span>
            </div>
            <div class="sidebar-item" data-section="power">
                <span class="icon">ğŸ”‹</span>
                <span class="text">ØªÙˆÙÙŠØ± Ø§Ù„Ø·Ø§Ù‚Ø©</span>
            </div>
            <div class="sidebar-item" data-section="language">
                <span class="icon">ğŸŒ</span>
                <span class="text">Ø§Ù„Ù„ØºØ©</span>
            </div>
            <div class="sidebar-item" data-section="faq">
                <span class="icon">â“</span>
                <span class="text">Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</span>
            </div>
            <div class="sidebar-item" data-section="support">
                <span class="icon">ğŸ“¬</span>
                <span class="text">Ø§Ù„Ø¯Ø¹Ù…</span>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
        <div class="content" id="content">
            <div class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, updatePassword, EmailAuthProvider, reauthenticateWithCredential, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, update, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDRCtfuYrEdnuKUsWu_79NC6G_xGLznBJc",
            authDomain: "tttrt-b8c5a.firebaseapp.com",
            databaseURL: "https://tttrt-b8c5a-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "tttrt-b8c5a",
            storageBucket: "tttrt-b8c5a.firebasestorage.app",
            messagingSenderId: "975123752593",
            appId: "1:975123752593:web:e591e930af3a3e29568130"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
        const sidebar = document.getElementById('sidebar');
        const contentDiv = document.getElementById('content');
        const mainBackBtn = document.getElementById('mainBackBtn');
        const sidebarItems = document.querySelectorAll('.sidebar-item');
        
        let currentUser = null;
        let currentSection = 'account';
        let isFullScreen = false;

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙØ¶ÙŠÙ„Ø§Øª (Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†)
        const darkMode = localStorage.getItem('darkMode') === 'true';
        if (darkMode) {
            document.body.classList.add('dark-mode');
        }

        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            currentUser = user;
            await loadUserData();
            showSection(currentSection, false);
        });

        async function loadUserData() {
            try {
                const userRef = ref(database, 'users/' + currentUser.uid);
                const snapshot = await get(userRef);
                if (snapshot.exists()) {
                    window.userData = snapshot.val();
                } else {
                    window.userData = { email: currentUser.email };
                }
            } catch (error) {
                console.error(error);
                window.userData = { email: currentUser.email };
            }
        }

        sidebarItems.forEach(item => {
            item.addEventListener('click', () => {
                const section = item.dataset.section;
                currentSection = section;
                enterFullScreen(section);
            });
        });

        function enterFullScreen(section) {
            isFullScreen = true;
            sidebar.classList.add('hidden');
            contentDiv.classList.add('full');
            mainBackBtn.onclick = exitFullScreen;
            showSection(section, true);
        }

        function exitFullScreen() {
            isFullScreen = false;
            sidebar.classList.remove('hidden');
            contentDiv.classList.remove('full');
            mainBackBtn.onclick = goBack;
            showSection(currentSection, false);
        }

        function showSection(section, fullScreen) {
            let html = '';
            switch (section) {
                case 'account':
                    html = renderAccount();
                    break;
                case 'chats':
                    html = renderChats();
                    break;
                case 'privacy':
                    html = renderPrivacy();
                    break;
                case 'notifications':
                    html = renderNotifications();
                    break;
                case 'storage':
                    html = renderStorage();
                    break;
                case 'folders':
                    html = renderFolders();
                    break;
                case 'devices':
                    html = renderDevices();
                    break;
                case 'power':
                    html = renderPower();
                    break;
                case 'language':
                    html = renderLanguage();
                    break;
                case 'faq':
                    html = renderFaq();
                    break;
                case 'support':
                    // ÙØªØ­ ØµÙØ­Ø© Ø§Ù„Ø¯Ø¹Ù… Ù…Ø¨Ø§Ø´Ø±Ø©
                    window.location.href = 'support.html';
                    return;
                default:
                    html = '<div class="loading">Ù‚Ø±ÙŠØ¨Ø§Ù‹...</div>';
            }
            contentDiv.innerHTML = html;
            attachEvents(section);
        }

        function renderAccount() {
            const user = window.userData || {};
            const photoURL = user.photoURL || '';
            const initials = (user.fullName || user.username || 'U').charAt(0).toUpperCase();
            const bio = user.bio || '';
            const phone = user.phone || '';
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø­Ø³Ø§Ø¨</h2>
                    <div class="profile-image">
                        ${photoURL ? 
                            `<img src="${photoURL}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" id="profileImg">` : 
                            `<div class="avatar-placeholder" id="profilePlaceholder">${initials}</div>`
                        }
                        <div class="image-upload">
                            <label for="uploadImage">ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©</label>
                            <input type="file" id="uploadImage" accept="image/*" onchange="uploadImage()">
                        </div>
                    </div>
                    <div class="user-info">
                        <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> ${user.fullName || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</strong> ${user.username || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><strong>Ø§Ù„Ø¨Ø±ÙŠØ¯:</strong> ${user.email || currentUser?.email}</p>
                        <p><strong>Ø§Ù„Ù‡Ø§ØªÙ:</strong> ${phone || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                        <p><strong>Ù†Ø¨Ø°Ø©:</strong> ${bio || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</p>
                    </div>
                    <h3>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</h3>
                    <div class="input-group">
                        <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯</label>
                        <input type="text" id="newFullName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯" value="${user.fullName || ''}">
                    </div>
                    <div class="input-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="text" id="newPhone" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" value="${phone}">
                    </div>
                    <div class="input-group">
                        <label>Ù†Ø¨Ø°Ø© Ø¹Ù†Ùƒ</label>
                        <textarea id="newBio" placeholder="Ø£Ø¯Ø®Ù„ Ù†Ø¨Ø°Ø© Ù‚ØµÙŠØ±Ø©">${bio}</textarea>
                    </div>
                    <button class="btn" onclick="updateProfile()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª</button>
                    <div id="profileMessage" class="message"></div>

                    <h3 style="margin-top: 2rem;">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</h3>
                    <div class="input-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                        <input type="password" id="currentPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ©">
                    </div>
                    <div class="input-group">
                        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©</label>
                        <input type="password" id="newPassword" placeholder="6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„">
                    </div>
                    <div class="input-group">
                        <label>ØªØ£ÙƒÙŠØ¯ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                        <input type="password" id="confirmPassword" placeholder="Ø£Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                    </div>
                    <button class="btn" onclick="changePassword()">ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</button>
                    <div id="passwordMessage" class="message"></div>

                    <button class="btn btn-danger" onclick="logout()" style="margin-top: 2rem;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
                </div>
            `;
        }

        function renderChats() {
            return `
                <div class="content-card">
                    <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h2>
                    <p class="info-text">Ø®Ù„ÙÙŠØ© Ø§Ù„Ø´Ø§Ø´Ø©ØŒ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠØŒ Ø§Ù„Ù…Ø¤Ø«Ø±Ø§Øª Ø§Ù„Ø­Ø±ÙƒÙŠØ©</p>
                    <div style="margin-top: 1rem;">
                        <div class="input-group">
                            <label>Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†</label>
                            <button class="btn ${document.body.classList.contains('dark-mode') ? 'btn-secondary' : ''}" onclick="toggleDarkMode()">
                                ${document.body.classList.contains('dark-mode') ? 'ØªØ¹Ø·ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†' : 'ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†'}
                            </button>
                        </div>
                        <p>ğŸ”§ Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderPrivacy() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø®ØµÙˆØµÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù†</h2>
                    <p class="info-text">Ø¢Ø®Ø± Ø¸Ù‡ÙˆØ±ØŒ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©ØŒ Ù…ÙØ§ØªÙŠØ­ Ø§Ù„Ù…Ø±ÙˆØ±</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderNotifications() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
                    <p class="info-text">Ø§Ù„Ø£ØµÙˆØ§ØªØŒ Ø§Ù„Ù…ÙƒØ§Ù„Ù…Ø§ØªØŒ Ø§Ù„Ø´Ø§Ø±Ø§Øª</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderStorage() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ†</h2>
                    <p class="info-text">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderFolders() {
            return `
                <div class="content-card">
                    <h2>Ù…Ø¬Ù„Ø¯Ø§Øª Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</h2>
                    <p class="info-text">ÙØ±Ø² Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙÙŠ Ù…Ø¬Ù„Ø¯Ø§Øª</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderDevices() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø£Ø¬Ù‡Ø²Ø©</h2>
                    <p class="info-text">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…ØªØµÙ„Ø©</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderPower() {
            return `
                <div class="content-card">
                    <h2>ØªÙˆÙÙŠØ± Ø§Ù„Ø·Ø§Ù‚Ø©</h2>
                    <p class="info-text">ØªÙ‚Ù„ÙŠÙ„ Ø§Ø³ØªÙ‡Ù„Ø§Ùƒ Ø§Ù„Ø·Ø§Ù‚Ø© Ø¹Ù†Ø¯ Ø§Ù†Ø®ÙØ§Ø¶ Ø§Ù„Ø´Ø­Ù†</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ Ù‚ÙŠØ¯ Ø§Ù„ØªØ·ÙˆÙŠØ±...</p>
                    </div>
                </div>
            `;
        }

        function renderLanguage() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ù„ØºØ©</h2>
                    <p class="info-text">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (Ù…Ø­Ø¯Ø¯Ø© Ø­Ø§Ù„ÙŠØ§Ù‹)</p>
                    <div style="margin-top: 1rem;">
                        <p>ğŸ”§ ÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ± Ø§Ù„Ù„ØºØ© Ù„Ø§Ø­Ù‚Ø§Ù‹...</p>
                    </div>
                </div>
            `;
        }

        function renderFaq() {
            return `
                <div class="content-card">
                    <h2>Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©</h2>
                    <div class="faq-item">
                        <h4 onclick="toggleFaq(this)">ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØºÙŠÙŠØ± Ø§Ø³Ù…ÙŠØŸ <span>â–¼</span></h4>
                        <p>ÙŠÙ…ÙƒÙ†Ùƒ ØªØºÙŠÙŠØ± Ø§Ø³Ù…Ùƒ Ù…Ù† Ù‚Ø³Ù… "Ø§Ù„Ø­Ø³Ø§Ø¨" ÙÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªØŒ Ø«Ù… Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ ÙˆØ§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØ­Ø¯ÙŠØ«.</p>
                    </div>
                    <div class="faq-item">
                        <h4 onclick="toggleFaq(this)">ÙƒÙŠÙ Ø£ØºÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ <span>â–¼</span></h4>
                        <p>Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ Ù‚Ø³Ù… "Ø§Ù„Ø­Ø³Ø§Ø¨"ØŒ Ø«Ù… Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ÙˆØ§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø«Ù… Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±.</p>
                    </div>
                    <div class="faq-item">
                        <h4 onclick="toggleFaq(this)">ÙƒÙŠÙ Ø£Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†ØŸ <span>â–¼</span></h4>
                        <p>ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ ÙˆØ§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø°ÙŠ ØªØ±ÙŠØ¯Ù‡.</p>
                    </div>
                    <div class="faq-item">
                        <h4 onclick="toggleFaq(this)">ÙƒÙŠÙ Ø£Ø¶ÙŠÙ ØµÙˆØ±Ø© Ù„Ù„Ù…Ù„Ù Ø§Ù„Ø´Ø®ØµÙŠØŸ <span>â–¼</span></h4>
                        <p>ÙÙŠ Ù‚Ø³Ù… "Ø§Ù„Ø­Ø³Ø§Ø¨"ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø²Ø± "ØªØºÙŠÙŠØ± Ø§Ù„ØµÙˆØ±Ø©" ÙˆØ§Ø®ØªØ± ØµÙˆØ±Ø© Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ.</p>
                    </div>
                    <div class="faq-item">
                        <h4 onclick="toggleFaq(this)">Ù‡Ù„ ØªØ·Ø¨ÙŠÙ‚Ù†Ø§ Ù…Ø¬Ø§Ù†ÙŠØŸ <span>â–¼</span></h4>
                        <p>Ù†Ø¹Ù…ØŒ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø¬Ø§Ù†ÙŠ Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙˆÙ„Ø§ ØªÙˆØ¬Ø¯ Ø£ÙŠ Ø±Ø³ÙˆÙ….</p>
                    </div>
                </div>
            `;
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¶Ø§ÙÙŠØ©
        window.toggleFaq = function(header) {
            const item = header.closest('.faq-item');
            item.classList.toggle('active');
            const span = header.querySelector('span');
            span.textContent = item.classList.contains('active') ? 'â–²' : 'â–¼';
        };

        // Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
        window.uploadImage = async function() {
            const fileInput = document.getElementById('uploadImage');
            if (!fileInput.files.length) return;
            const file = fileInput.files[0];
            const fileRef = storageRef(storage, `profile_images/${currentUser.uid}/${Date.now()}_${file.name}`);
            try {
                await uploadBytes(fileRef, file);
                const downloadURL = await getDownloadURL(fileRef);
                // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                const userRef = ref(database, 'users/' + currentUser.uid);
                await update(userRef, { photoURL: downloadURL });
                window.userData.photoURL = downloadURL;
                showMessage(document.getElementById('profileMessage'), 'ØªÙ… Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', true);
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©
                const profileImg = document.getElementById('profileImg');
                if (profileImg) {
                    profileImg.src = downloadURL;
                } else {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ù†Ø¹ÙŠØ¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ø³Ù…
                    showSection('account', isFullScreen);
                }
            } catch (error) {
                console.error(error);
                showMessage(document.getElementById('profileMessage'), 'ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©: ' + error.message, false);
            }
        };

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª
        window.updateProfile = async function() {
            const newName = document.getElementById('newFullName')?.value.trim();
            const newPhone = document.getElementById('newPhone')?.value.trim();
            const newBio = document.getElementById('newBio')?.value.trim();
            const msgDiv = document.getElementById('profileMessage');
            const updates = {};
            if (newName) updates.fullName = newName;
            if (newPhone) updates.phone = newPhone;
            if (newBio) updates.bio = newBio;
            if (Object.keys(updates).length === 0) {
                showMessage(msgDiv, 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±Ø§Øª', false);
                return;
            }
            try {
                const userRef = ref(database, 'users/' + currentUser.uid);
                await update(userRef, updates);
                Object.assign(window.userData, updates);
                showMessage(msgDiv, 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', true);
            } catch (error) {
                showMessage(msgDiv, 'Ø®Ø·Ø£: ' + error.message, false);
            }
        };

        window.changePassword = async function() {
            const current = document.getElementById('currentPassword')?.value;
            const newPass = document.getElementById('newPassword')?.value;
            const confirm = document.getElementById('confirmPassword')?.value;
            const msgDiv = document.getElementById('passwordMessage');
            if (!current || !newPass || !confirm) {
                showMessage(msgDiv, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨Ø©', false);
                return;
            }
            if (newPass.length < 6) {
                showMessage(msgDiv, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙŠØ¬Ø¨ Ø£Ù† ØªÙƒÙˆÙ† 6 Ø£Ø­Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„', false);
                return;
            }
            if (newPass !== confirm) {
                showMessage(msgDiv, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± Ù…ØªØ·Ø§Ø¨Ù‚Ø©', false);
                return;
            }
            try {
                const credential = EmailAuthProvider.credential(currentUser.email, current);
                await reauthenticateWithCredential(currentUser, credential);
                await updatePassword(currentUser, newPass);
                showMessage(msgDiv, 'ØªÙ… ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø¨Ù†Ø¬Ø§Ø­', true);
                document.getElementById('currentPassword').value = '';
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
            } catch (error) {
                if (error.code === 'auth/wrong-password') {
                    showMessage(msgDiv, 'ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© ØºÙŠØ± ØµØ­ÙŠØ­Ø©', false);
                } else {
                    showMessage(msgDiv, 'Ø®Ø·Ø£: ' + error.message, false);
                }
            }
        };

        window.toggleDarkMode = function() {
            const body = document.body;
            const isDark = body.classList.contains('dark-mode');
            if (isDark) {
                body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
            } else {
                body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
            }
            // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ† ÙÙŠ Ø§Ù„Ù‚Ø³Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ
            if (currentSection === 'chats') {
                showSection('chats', isFullScreen);
            }
        };

        window.logout = async function() {
            await signOut(auth);
        };

        window.goBack = function() {
            window.location.href = 'app.html';
        };

        function showMessage(element, text, isSuccess) {
            element.textContent = text;
            element.className = isSuccess ? 'message success' : 'message error';
        }

        window.showMessage = showMessage;

        function attachEvents(section) {
            // ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø³ØªÙ…Ø¹Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© Ù‡Ù†Ø§ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø±
        }
    </script>
</body>
</html>
